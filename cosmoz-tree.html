
<!--
Navigator through object with treelike datastructure.
-->

<script>
	'use strict';

	Polymer({ is: 'cosmoz-tree' });

	window.Cosmoz = window.Cosmoz || {};


	/* eslint-disable no-unused-vars */

	/**
	 * Cosmoz.Tree
	 *
	 * @constructor
	 */
	Cosmoz.Tree = function () {
		if (this.constructor === Cosmoz.Tree) {
			throw new Error('abstract');
		}
	};

	Cosmoz.Tree.prototype = {
		getNodeByProperty: function (propertyName, propertyValue) {
			throw new Error('Must be implemented in derived object');
		},

		getPath: function (node) {
			throw new Error('Must be implemented in derived object');
		},

		getPathByProperty: function (propertyName, propertyValue) {
			throw new Error('Must be implemented in derived object');
		},

		getChildren: function (node) {
			throw new Error('Must be implemented in derived object');
		},

		getProperty: function (node, propertyName) {
			throw new Error('Must be implemented in derived object');
		},

		getPathString: function (node, textPropertyName, separator) {
			var path = this.getPath(node);
			return path.map(function (n) {
				return this.getProperty(n, textPropertyName);
			}, this).join(separator);
		},

		getPathStringByProperty: function (propertyName, propertyValue, textPropertyName, separator) {
			var node = this.getNodeByProperty(propertyName, propertyValue);
			if (node !== undefined) {
				return this.getPathString(node, textPropertyName, separator);
			}
		},

		nodeConformsSearch: function (node, propertyName, propertyValue, exact) {
			var property = this.getProperty(node, propertyName);

			switch (exact) {
				case true:
					if (property === propertyValue) {
						return true;
					}
					break;
			
				case false:
					if (property.toLowerCase().indexOf(propertyValue.toLowerCase()) > -1) {
						return true;
					}
					break;
			
				default:
					return false;
					break;
			}
			
			return false;
		},

		/**
		 * After node found and before pushed to results array.
		 */
		afterFound: function (node) {
			return node;
		},

		/**
		 * Basic search for a node by one of its property
		 */
		search: function (node, propertyName, propertyValue, exact = true, all = false, results = []) {
			var nodeConforms = this.nodeConformsSearch(node, propertyName, propertyValue, exact),
				children,
				result,
				i;

			if (nodeConforms) {
				if (all) {
					results.push(this.afterFound(node));
				} else {
					return node;
				}
			}

			children = this.getChildren(node);

			if (children && Array.isArray(children)) {
				for (i = 0; i < children.length; i++) {
					var child = children[i];
					result = this.search(children[i], propertyName, propertyValue, exact, all, results);
					if (!Array.isArray(result)) {
						return result;
					}
				}				
			}

			return results;
		}
	};
</script>
