
<!--
Navigator through object with treelike datastructure.
-->

<script>
	'use strict';

	Polymer({ is: 'cosmoz-tree' });

	window.Cosmoz = window.Cosmoz || {};


	/* eslint-disable no-unused-vars */

	/**
	 * Cosmoz.Tree
	 *
	 * @constructor
	 */
	Cosmoz.Tree = function () {
		if (this.constructor === Cosmoz.Tree) {
			throw new Error('abstract');
		}
	};

	Cosmoz.Tree.prototype = {
		getNodeByProperty: function (propertyName, propertyValue) {
			throw new Error('Must be implemented in derived object');
		},

		getPath: function (node) {
			throw new Error('Must be implemented in derived object');
		},

		getPathString: function (node) {
			throw new Error('Must be implemented in derived object');
		},

		getChildren: function (node, asList) {
			throw new Error('Must be implemented in derived object');
		},

		getProperty: function (node, propertyName) {
			throw new Error('Must be implemented in derived object');
		},

		/**
		 * Returns True if a node fullfills the search criteria.
		 */
		nodeConformsSearch: function (node, propertyName, propertyValue, exact) {
			var property = this.getProperty(node, propertyName);

			switch (exact) {
				case true:
					if (property === propertyValue) {
						return true;
					}
					break;
			
				case false:
					if (property.toLowerCase().indexOf(propertyValue.toLowerCase()) > -1) {
						return true;
					}
					break;
			
				default:
					return false;
					break;
			}
			
			return false;
		},

		/**
		 * Gets called after a node has been found 
		 * and before pushed to results array.
		 */
		afterFound: function (node, propertyName, propertyValue) {
			return node;
		},

		/**
		 * Basic search for a node by one of its properties.
		 */
		search: function (node, propertyName, propertyValue, exact, all, results) {
			var nodeConforms = this.nodeConformsSearch(node, propertyName, propertyValue, exact),
				children,
				result,
				i;
			
			// Defaults
			exact = exact !== undefined ? exact : true;
			all = all !== undefined ? all : false;
			results = results ? results : [];

			if (nodeConforms) {
				if (!all) {
					return node;
				}
				
				results.push(this.afterFound(node, propertyName, propertyValue));
			}

			children = this.getChildren(node, true);

			if (Array.isArray(children)) {
				for (i = 0; i < children.length; i++) {
					result = this.search(children[i], propertyName, propertyValue, exact, all, results);
					if (!Array.isArray(result)) {
						return result;
					}
				}
			}

			return results;
		}
	};
</script>
