<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

	<title>cosmoz-tree test</title>

	<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
	<script src="../../web-component-tester/browser.js"></script>

	<link rel="import" href="../cosmoz-default-tree.html">
	<link rel="import" href="../../iron-ajax/iron-ajax.html">
</head>
<body>
	<test-fixture id="basic">
		<template>
			<iron-ajax auto
				url="data/basicTree.json"
				handle-as="json"
				last-response="{{ basicTree }}">
			</iron-ajax>
		</template>
	</test-fixture>

	<test-fixture id="multiRoot">
		<template>
			<iron-ajax auto
				url="data/multiRootTree.json"
				handle-as="json"
				last-response="{{ multiRootTree }}">
			</iron-ajax>
		</template>
	</test-fixture>

	<test-fixture id="missingAncestor">
		<template>
			<iron-ajax auto
				url="data/missingAncestorTree.json"
				handle-as="json"
				last-response="{{ missingAncestorTree }}">
			</iron-ajax>
		</template>
	</test-fixture>

	<script>
	/*global WCT, suite, fixture, setup, suiteSetup, test, Polymer, assert */
	(function () {
		'use strict';
		suite('basic', function () {
			var basicFixture,
				basicTree;

			suiteSetup(function (done) {
				basicFixture = fixture('basic');
				basicFixture.addEventListener('response', function () {
					basicTree = new Cosmoz.DefaultTree(basicFixture.lastResponse);
					done();
				});
			});

			test('instantiating a Cosmoz.Tree works', function () {
				assert.isNotNull(basicTree);
			});

			test('getNodeById', function () {
				var
					root = basicTree.getNodeByProperty('id', '11111111-1111-1111-1111-111111111111'),
					node2 = basicTree.getNodeByProperty('id', '167d1485-7d4f-4c7d-86cd-a4fb00f31245'),
					node3 = basicTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node4 = basicTree.getNodeByProperty('id', '2b547550-b874-4228-9395-a4fb00f31245');
				assert.isNotNull(root);
				assert.isNotNull(node2);
				assert.isNotNull(node3);
				assert.isNotNull(node4);
			});
			test('getNodeByPathLocator', function () {
				var
					root = basicTree.getNodeByProperty('pathLocator', '1'),
					node2 = basicTree.getNodeByProperty('pathLocator', '1.2'),
					node3 = basicTree.getNodeByProperty('pathLocatord', '1.2.3'),
					node4 = basicTree.getNodeByProperty('pathLocator', '1.2.3.301');
				assert.isNotNull(root);
				assert.isNotNull(node2);
				assert.isNotNull(node3);
				assert.isNotNull(node4);
			});

			test('getPath', function () {
				var
					root = basicTree.getNodeByProperty('id', '11111111-1111-1111-1111-111111111111'),
					node2 = basicTree.getNodeByProperty('id', '167d1485-7d4f-4c7d-86cd-a4fb00f31245'),
					node3 = basicTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node4 = basicTree.getNodeByProperty('id', '2b547550-b874-4228-9395-a4fb00f31245'),
					rootPath = basicTree.getPath(root),
					node2Path = basicTree.getPath(node2),
					node3Path = basicTree.getPath(node3),
					node4Path = basicTree.getPath(node4);

				assert.equal(rootPath.length, 1);
				assert.equal(rootPath[0], root);

				assert.equal(node2Path.length, 2);
				assert.equal(node2Path[0], root);
				assert.equal(node2Path[1], node2);

				assert.equal(node3Path.length, 3);
				assert.equal(node3Path[0], root);
				assert.equal(node3Path[1], node2);
				assert.equal(node3Path[2], node3);

				assert.equal(node4Path.length, 2);
				assert.equal(node4Path[0], root);
				assert.equal(node4Path[1], node4);

			});

			test('getPathText', function () {
				var	node301 = basicTree.getNodeByProperty('pathLocator', '1.2.3.301'),
					node301PathText = basicTree.getPathText(node301, 'name');

				assert.equal(node301PathText.length, 4);
				assert.equal(node301PathText[0], 'Root');
				assert.equal(node301PathText[1], 'Node2');
				assert.equal(node301PathText[2], 'Node3');
				assert.equal(node301PathText[3], 'Node301');

			});
		});

		suite('multiRoot', function () {
			var multiRootFixture,
				multiRootTree;

			suiteSetup(function (done) {
				multiRootFixture = fixture('multiRoot');
				multiRootFixture.addEventListener('response', function () {
					multiRootTree = new Cosmoz.DefaultTree(multiRootFixture.lastResponse);
					done();
				});
			});

			test('instantiating a Cosmoz.Tree works', function () {
				assert.isNotNull(multiRootTree);
			});

			test('getNodeByProperty', function () {
				var node2 = multiRootTree.getNodeByProperty('id', '167d1485-7d4f-4c7d-86cd-a4fb00f31245'),
					node3 = multiRootTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node4 = multiRootTree.getNodeByProperty('id', '2b547550-b874-4228-9395-a4fb00f31245');
				assert.isNotNull(node2);
				assert.isNotNull(node3);
				assert.isNotNull(node4);

			});

			test('getPath', function () {
				var
					node2 = multiRootTree.getNodeByProperty('id', '167d1485-7d4f-4c7d-86cd-a4fb00f31245'),
					node3 = multiRootTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node4 = multiRootTree.getNodeByProperty('id', '2b547550-b874-4228-9395-a4fb00f31245'),
					node2Path = multiRootTree.getPath(node2),
					node3Path = multiRootTree.getPath(node3),
					node4Path = multiRootTree.getPath(node4);

				assert.equal(node2Path.length, 1);
				assert.equal(node2Path[0], node2);

				assert.equal(node3Path.length, 2);
				assert.equal(node3Path[0], node2);
				assert.equal(node3Path[1], node3);

				assert.equal(node4Path.length, 1);
				assert.equal(node4Path[0], node4);

			});
		});

		suite('missingAncestor', function () {
			var missingAncestorFixture,
				missingAncestorTree;

			suiteSetup(function (done) {
				missingAncestorFixture = fixture('missingAncestor');
				missingAncestorFixture.addEventListener('response', function () {
					missingAncestorTree = new Cosmoz.DefaultTree(missingAncestorFixture.lastResponse);
					done();
				});
			});

			test('instantiating a Cosmoz.Tree works', function () {
				assert.isNotNull(missingAncestorTree);
			});

			test('getNodeByProperty', function () {
				var node2 = missingAncestorTree.getNodeByProperty('id', '167d1485-7d4f-4c7d-86cd-a4fb00f31245'),
					node301 = missingAncestorTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node401 = missingAncestorTree.getNodeByProperty('id', '865065da-f44c-472e-a8df-a4fb00f3124b');
				assert.isNotNull(node2);
				assert.isNotNull(node301);
				assert.isNotNull(node401);

			});

			test('getPath', function () {
				var
					node301 = missingAncestorTree.getNodeByProperty('id', '3a7654f1-e3e6-49c7-b6a8-a4fb00f31245'),
					node401 = missingAncestorTree.getNodeByProperty('id', '865065da-f44c-472e-a8df-a4fb00f3124b'),
					node301Path = missingAncestorTree.getPath(node301),
					node401Path = missingAncestorTree.getPath(node401);

				assert.equal(node301Path.length, 1);
				assert.equal(node301Path[0], node301);

				assert.equal(node401Path.length, 2);
				assert.equal(node401Path[0], node301);
				assert.equal(node401Path[1], node401);

			});
		});
	}());
	</script>
  </body>
</html>
